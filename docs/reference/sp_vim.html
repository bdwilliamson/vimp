<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Shapley Population Variable Importance Measure (SPVIM) Estimates and Inference — sp_vim • vimp</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Shapley Population Variable Importance Measure (SPVIM) Estimates and Inference — sp_vim" />
<meta property="og:description" content="Compute estimates and confidence intervals for the SPVIMs, using cross-fitting." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vimp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/introduction-to-vimp.html">Introduction to `vimp`</a>
    </li>
    <li>
      <a href="../articles/precomputed-regressions.html">Using precomputed regression function estimates in `vimp`</a>
    </li>
    <li>
      <a href="../articles/types-of-vims.html">Types of VIMs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bdwilliamson/vimp/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Shapley Population Variable Importance Measure (SPVIM) Estimates and Inference</h1>
    <small class="dont-index">Source: <a href='https://github.com/bdwilliamson/vimp/blob/master/R/sp_vim.R'><code>R/sp_vim.R</code></a></small>
    <div class="hidden name"><code>sp_vim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute estimates and confidence intervals for the SPVIMs, using cross-fitting.</p>
    </div>

    <pre class="usage"><span class='fu'>sp_vim</span>(
  <span class='kw'>Y</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>X</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>V</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"r_squared"</span>,
  <span class='kw'>SL.library</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"SL.glmnet"</span>, <span class='st'>"SL.xgboost"</span>, <span class='st'>"SL.mean"</span>),
  <span class='kw'>univariate_SL.library</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>gamma</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>,
  <span class='kw'>delta</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>stratified</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>C</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>Y</span>)),
  <span class='kw'>Z</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>ipc_weights</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>Y</span>)),
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>the outcome.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>the covariates.</p></td>
    </tr>
    <tr>
      <th>V</th>
      <td><p>the number of folds for cross-fitting, defaults to 10.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>the type of parameter (e.g., R-squared-based is <code>"r_squared"</code>). Note that <code>type = 'anova'</code> is not allowed for SPVIMs.</p></td>
    </tr>
    <tr>
      <th>SL.library</th>
      <td><p>a character vector of learners to pass to <code>SuperLearner</code>, if <code>f1</code> and <code>f2</code> are Y and X, respectively. Defaults to <code>SL.glmnet</code>, <code>SL.xgboost</code>, and <code>SL.mean</code>.</p></td>
    </tr>
    <tr>
      <th>univariate_SL.library</th>
      <td><p>(optional) a character vector of learners to pass to <code>SuperLearner</code> for estimating univariate regression functions. Defaults to <code>SL.polymars</code></p></td>
    </tr>
    <tr>
      <th>gamma</th>
      <td><p>the fraction of the sample size to use when sampling subsets (e.g., <code>gamma = 1</code> samples the same number of subsets as the sample size)</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>the level to compute the confidence interval at. Defaults to 0.05, corresponding to a 95% confidence interval.</p></td>
    </tr>
    <tr>
      <th>delta</th>
      <td><p>the value of the \(\delta\)-null (i.e., testing if importance &lt; \(\delta\)); defaults to 0.</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>should we remove NA's in the outcome and fitted values in computation? (defaults to <code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>stratified</th>
      <td><p>should the generated folds be stratified based on the outcome (helps to ensure class balance across cross-fitting folds)?</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>should <code>sp_vim</code> and <code>SuperLearner</code> print out progress? (defaults to <code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>C</th>
      <td><p>the indicator of coarsening (1 denotes observed, 0 denotes unobserved).</p></td>
    </tr>
    <tr>
      <th>Z</th>
      <td><p>either (i) NULL (the default, in which case the argument <code>C</code> above must be all ones), or (ii) a character vector specifying the variable(s) among Y and X that are thought to play a role in the coarsening mechanism.</p></td>
    </tr>
    <tr>
      <th>ipc_weights</th>
      <td><p>weights for the computed influence curve (i.e., inverse probability weights for coarsened-at-random settings). Assumed to be already inverted (i.e., ipc_weights = 1 / [estimated probability weights]).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other arguments to the estimation tool, see "See also".</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>vim</code>. See Details for more information.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>We define the SPVIM as the weighted average of the population difference in
predictiveness over all subsets of features not containing feature \(j\).</p>
<p>This is equivalent to finding the solution to a population weighted least squares problem. This
key fact allows us to estimate the SPVIM using weighted least squares, where we first
sample subsets from the power set of all possible features using the Shapley sampling distribution; then
use cross-fitting to obtain estimators of the predictiveness of each sampled subset; and finally, solve the
least squares problem given in Williamson and Feng (2020).</p>
<p>See the paper by Williamson and Feng (2020) for more
details on the mathematics behind this function, and the validity
of the confidence intervals.
The function works by estimating
In the interest of transparency, we return most of the calculations
within the <code>vim</code> object. This results in a list containing:</p><ul>
<li><p>SL.library - the library of learners passed to <code>SuperLearner</code></p></li>
<li><p>v- the estimated predictiveness measure for each sampled subset</p></li>
<li><p>preds_lst - the predicted values from the chosen method for each sampled subset</p></li>
<li><p>est - the estimated SPVIM value for each feature</p></li>
<li><p>ic_lst - the influence functions for each sampled subset</p></li>
<li><p>ic- a list of the SPVIM influence function contributions</p></li>
<li><p>se - the standard errors for the estimated variable importance</p></li>
<li><p>ci - the \((1-\alpha) \times 100\)% confidence intervals based on the variable importance estimates</p></li>
<li><p>gamma- the fraction of the sample size used when sampling subsets</p></li>
<li><p>alpha - the level, for confidence interval calculation</p></li>
<li><p>delta- the <code>delta</code> value used for hypothesis testing</p></li>
<li><p>y - the outcome</p></li>
<li><p>ipc_weights - the weights</p></li>
<li><p>mat- a tibble with the estimates, SEs, CIs, hypothesis testing decisions, and p-values</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner</a></code> for specific usage of the <code>SuperLearner</code> function and package.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>SuperLearner</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ranger</span>)
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span>
<span class='co'># generate the data</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span>(<span class='no'>p</span>, <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='no'>n</span>, -<span class='fl'>5</span>, <span class='fl'>5</span>)))

<span class='co'># apply the function to the x's</span>
<span class='no'>smooth</span> <span class='kw'>&lt;-</span> (<span class='no'>x</span>[,<span class='fl'>1</span>]/<span class='fl'>5</span>)^<span class='fl'>2</span>*(<span class='no'>x</span>[,<span class='fl'>1</span>]+<span class='fl'>7</span>)/<span class='fl'>5</span> + (<span class='no'>x</span>[,<span class='fl'>2</span>]/<span class='fl'>3</span>)^<span class='fl'>2</span>

<span class='co'># generate Y ~ Normal (smooth, 1)</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='no'>smooth</span> + <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>, <span class='fl'>0</span>, <span class='fl'>1</span>))

<span class='co'># set up a library for SuperLearner</span>
<span class='no'>learners</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"SL.mean"</span>, <span class='st'>"SL.ranger"</span>)

<span class='co'># -----------------------------------------</span>
<span class='co'># using Super Learner (with a small number of CV folds,</span>
<span class='co'># for illustration only)</span>
<span class='co'># -----------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>4747</span>)
<span class='no'>est</span> <span class='kw'>&lt;-</span> <span class='fu'>sp_vim</span>(<span class='kw'>Y</span> <span class='kw'>=</span> <span class='no'>y</span>, <span class='kw'>X</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>V</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"r_squared"</span>,
<span class='kw'>SL.library</span> <span class='kw'>=</span> <span class='no'>learners</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: number of items to replace is not a multiple of replacement length</span></div><div class='output co'>#&gt; <span class='warning'>Warning: number of items to replace is not a multiple of replacement length</span></div><div class='output co'>#&gt; <span class='warning'>Warning: number of items to replace is not a multiple of replacement length</span></div><div class='output co'>#&gt; <span class='warning'>Warning: One or more original estimates &lt; 0; returning zero for these indices.</span></div><div class='output co'>#&gt; <span class='error'>Error in tcrossprod(x, y): requires numeric/complex matrix/vector arguments</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brian D. Williamson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


