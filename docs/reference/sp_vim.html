<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Shapley Population Variable Importance Measure (SPVIM) Estimates and Inference — sp_vim • vimp</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Shapley Population Variable Importance Measure (SPVIM) Estimates and Inference — sp_vim"><meta property="og:description" content="Compute estimates and confidence intervals for the SPVIMs, using cross-fitting."><meta property="og:image" content="http://bdwilliamson.github.io/vimp/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vimp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction-to-vimp.html">Introduction to `vimp`</a>
    </li>
    <li>
      <a href="../articles/ipcw-vim.html">Variable importance with coarsened data</a>
    </li>
    <li>
      <a href="../articles/precomputed-regressions.html">Using precomputed regression function estimates in `vimp`</a>
    </li>
    <li>
      <a href="../articles/types-of-vims.html">Types of VIMs</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bdwilliamson/vimp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Shapley Population Variable Importance Measure (SPVIM) Estimates and Inference</h1>
    <small class="dont-index">Source: <a href="https://github.com/bdwilliamson/vimp/blob/HEAD/R/sp_vim.R" class="external-link"><code>R/sp_vim.R</code></a></small>
    <div class="hidden name"><code>sp_vim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute estimates and confidence intervals for the SPVIMs, using cross-fitting.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sp_vim</span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  V <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"r_squared"</span>,</span>
<span>  SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.glmnet"</span>, <span class="st">"SL.xgboost"</span>, <span class="st">"SL.mean"</span><span class="op">)</span>,</span>
<span>  univariate_SL.library <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  stratified <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample_splitting <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  final_point_estimate <span class="op">=</span> <span class="st">"split"</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Z <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ipc_scale <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  ipc_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ipc_est_type <span class="op">=</span> <span class="st">"aipw"</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  scale_est <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cross_fitted_se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>Y</dt>
<dd><p>the outcome.</p></dd>


<dt>X</dt>
<dd><p>the covariates. If <code>type = "average_value"</code>, then the exposure
variable should be part of <code>X</code>, with its name provided in <code>exposure_name</code>.</p></dd>


<dt>V</dt>
<dd><p>the number of folds for cross-fitting, defaults to 5. If
<code>sample_splitting = TRUE</code>, then a special type of <code>V</code>-fold cross-fitting
is done. See Details for a more detailed explanation.</p></dd>


<dt>type</dt>
<dd><p>the type of importance to compute; defaults to
<code>r_squared</code>, but other supported options are <code>auc</code>,
<code>accuracy</code>, <code>deviance</code>, and <code>anova</code>.</p></dd>


<dt>SL.library</dt>
<dd><p>a character vector of learners to pass to
<code>SuperLearner</code>, if <code>f1</code> and <code>f2</code> are Y and X,
respectively. Defaults to <code>SL.glmnet</code>, <code>SL.xgboost</code>,
and <code>SL.mean</code>.</p></dd>


<dt>univariate_SL.library</dt>
<dd><p>(optional) a character vector of learners to
pass to <code>SuperLearner</code> for estimating univariate regression functions.
Defaults to <code>SL.polymars</code></p></dd>


<dt>gamma</dt>
<dd><p>the fraction of the sample size to use when sampling subsets
(e.g., <code>gamma = 1</code> samples the same number of subsets as the sample
size)</p></dd>


<dt>alpha</dt>
<dd><p>the level to compute the confidence interval at.
Defaults to 0.05, corresponding to a 95% confidence interval.</p></dd>


<dt>delta</dt>
<dd><p>the value of the \(\delta\)-null (i.e., testing if
importance &lt; \(\delta\)); defaults to 0.</p></dd>


<dt>na.rm</dt>
<dd><p>should we remove NAs in the outcome and fitted values
in computation? (defaults to <code>FALSE</code>)</p></dd>


<dt>stratified</dt>
<dd><p>if run_regression = TRUE, then should the generated
folds be stratified based on the outcome (helps to ensure class balance
across cross-validation folds)</p></dd>


<dt>verbose</dt>
<dd><p>should <code>sp_vim</code> and <code>SuperLearner</code> print out
progress? (defaults to <code>FALSE</code>)</p></dd>


<dt>sample_splitting</dt>
<dd><p>should we use sample-splitting to estimate the full and
reduced predictiveness? Defaults to <code>TRUE</code>, since inferences made using
<code>sample_splitting = FALSE</code> will be invalid for variables with truly zero
importance.</p></dd>


<dt>final_point_estimate</dt>
<dd><p>if sample splitting is used, should the final point estimates
be based on only the sample-split folds used for inference (<code>"split"</code>, the default),
or should they instead be based on the full dataset (<code>"full"</code>) or the average
across the point estimates from each sample split (<code>"average"</code>)? All three
options result in valid point estimates -- sample-splitting is only required for valid inference.</p></dd>


<dt>C</dt>
<dd><p>the indicator of coarsening (1 denotes observed, 0 denotes
unobserved).</p></dd>


<dt>Z</dt>
<dd><p>either (i) NULL (the default, in which case the argument
<code>C</code> above must be all ones), or (ii) a character vector
specifying the variable(s) among Y and X that are thought to play a
role in the coarsening mechanism. To specify the outcome, use <code>"Y"</code>; to
specify covariates, use a character number corresponding to the desired
position in X (e.g., <code>"1"</code>).</p></dd>


<dt>ipc_scale</dt>
<dd><p>what scale should the inverse probability weight correction be applied on (if any)?
Defaults to "identity". (other options are "log" and "logit")</p></dd>


<dt>ipc_weights</dt>
<dd><p>weights for the computed influence curve (i.e.,
inverse probability weights for coarsened-at-random settings).
Assumed to be already inverted (i.e., ipc_weights = 1 / [estimated
probability weights]).</p></dd>


<dt>ipc_est_type</dt>
<dd><p>the type of procedure used for coarsened-at-random
settings; options are "ipw" (for inverse probability weighting) or
"aipw" (for augmented inverse probability weighting).
Only used if <code>C</code> is not all equal to 1.</p></dd>


<dt>scale</dt>
<dd><p>should CIs be computed on original ("identity") or
another scale? (options are "log" and "logit")</p></dd>


<dt>scale_est</dt>
<dd><p>should the point estimate be scaled to be greater than or equal to 0?
Defaults to <code>TRUE</code>.</p></dd>


<dt>cross_fitted_se</dt>
<dd><p>should we use cross-fitting to estimate the standard
errors (<code>TRUE</code>, the default) or not (<code>FALSE</code>)?</p></dd>


<dt>...</dt>
<dd><p>other arguments to the estimation tool, see "See also".</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>vim</code>. See Details for more information.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>We define the SPVIM as the weighted average of the population
difference in predictiveness over all subsets of features not containing
feature \(j\).</p>
<p>This is equivalent to finding the solution to a population weighted least
squares problem. This key fact allows us to estimate the SPVIM using weighted
least squares, where we first sample subsets from the power set of all
possible features using the Shapley sampling distribution; then
use cross-fitting to obtain estimators of the predictiveness of each
sampled subset; and finally, solve the least squares problem given in
Williamson and Feng (2020).</p>
<p>See the paper by Williamson and Feng (2020) for more
details on the mathematics behind this function, and the validity
of the confidence intervals.</p>
<p>In the interest of transparency, we return most of the calculations
within the <code>vim</code> object. This results in a list containing:</p><dl><dt>SL.library</dt>
<dd><p>the library of learners passed to <code>SuperLearner</code></p></dd>

 <dt>v</dt>
<dd><p>the estimated predictiveness measure for each sampled subset</p></dd>

 <dt>fit_lst</dt>
<dd><p>the fitted values on the entire dataset from the chosen method for each sampled subset</p></dd>

 <dt>preds_lst</dt>
<dd><p>the cross-fitted predicted values from the chosen method for each sampled subset</p></dd>

 <dt>est</dt>
<dd><p>the estimated SPVIM value for each feature</p></dd>

 <dt>ics</dt>
<dd><p>the influence functions for each sampled subset</p></dd>

 <dt>var_v_contribs</dt>
<dd><p>the contibutions to the variance from estimating predictiveness</p></dd>

 <dt>var_s_contribs</dt>
<dd><p>the contributions to the variance from sampling subsets</p></dd>

 <dt>ic_lst</dt>
<dd><p>a list of the SPVIM influence function contributions</p></dd>

 <dt>se</dt>
<dd><p>the standard errors for the estimated variable importance</p></dd>

 <dt>ci</dt>
<dd><p>the \((1-\alpha) \times 100\)% confidence intervals based on the variable importance estimates</p></dd>

 <dt>p_value</dt>
<dd><p>p-values for the null hypothesis test of zero importance for each variable</p></dd>

 <dt>test_statistic</dt>
<dd><p>the test statistic for each null hypothesis test of zero importance</p></dd>

 <dt>test</dt>
<dd><p>a hypothesis testing decision for each null hypothesis test (for each variable having zero importance)</p></dd>

 <dt>gamma</dt>
<dd><p>the fraction of the sample size used when sampling subsets</p></dd>

 <dt>alpha</dt>
<dd><p>the level, for confidence interval calculation</p></dd>

 <dt>delta</dt>
<dd><p>the <code>delta</code> value used for hypothesis testing</p></dd>

 <dt>y</dt>
<dd><p>the outcome</p></dd>

 <dt>ipc_weights</dt>
<dd><p>the weights</p></dd>

 <dt>scale</dt>
<dd><p>the scale on which CIs were computed</p></dd>

 <dt>mat</dt>
<dd><p>- a tibble with the estimates, SEs, CIs, hypothesis testing decisions, and p-values</p></dd>


</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html" class="external-link">SuperLearner</a></code> for specific usage of the
  <code>SuperLearner</code> function and package.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="co"># generate the data</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># apply the function to the x's</span></span></span>
<span class="r-in"><span><span class="va">smooth</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">7</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate Y ~ Normal (smooth, 1)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">smooth</span> <span class="op">+</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set up a library for SuperLearner; note simple library for speed</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/ecpolley/SuperLearner" class="external-link">"SuperLearner"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.glm"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -----------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># using Super Learner (with a small number of CV folds,</span></span></span>
<span class="r-in"><span><span class="co"># for illustration only)</span></span></span>
<span class="r-in"><span><span class="co"># -----------------------------------------</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4747</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sp_vim</span><span class="op">(</span>Y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">x</span>, V <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"r_squared"</span>,</span></span>
<span class="r-in"><span>SL.library <span class="op">=</span> <span class="va">learners</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>One or more original estimates &lt; 0; returning zero for these indices.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Brian D. Williamson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

